[tools]
go = "1.24.6"
dprint = "latest"

[tasks.fmt]
description = "Format all files"
depends = ["fmt:go", "fmt:dprint"]

[tasks."fmt:go"]
description = "Format Go files"
run = "go fmt ./..."

[tasks."fmt:dprint"]
description = "Format non-Go files (md, yaml, json)"
run = "dprint fmt"

[tasks."fmt:check"]
description = "Check formatting without modifying files"
run = ["gofmt -l .", "dprint check"]

[tasks.build]
description = "Build all CLIs"
depends = ["build:gcs"]

[tasks."build:gcs"]
description = "Build reprint-gcs"
run = "go build -o reprint-gcs ./cmd/reprint-gcs"

[tasks."build:s3"]
description = "Build reprint-s3"
run = "go build -o reprint-s3 ./cmd/reprint-s3"

[tasks.test]
description = "Run unit tests"
run = "go test -short ./..."

[tasks."test:integration"]
description = "Run integration tests (requires fake-gcs-server)"
run = "go test -run Integration ./..."

[tasks."emulator:gcs"]
description = "Start fake-gcs-server"
run = "docker run --rm -p 4443:4443 --name fake-gcs-server fsouza/fake-gcs-server -scheme http -port 4443"

[tasks."emulator:gcs:stop"]
description = "Stop fake-gcs-server"
run = "docker stop fake-gcs-server"
